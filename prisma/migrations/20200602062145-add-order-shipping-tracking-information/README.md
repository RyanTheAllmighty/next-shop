# Migration `20200602062145-add-order-shipping-tracking-information`

This migration has been generated by Ryan Dowling at 6/2/2020, 6:21:45 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE `shop`.`Order` ADD COLUMN `addressId` int NOT NULL ,
ADD COLUMN `shippedAt` datetime(3)   ,
ADD COLUMN `shippingProvider` ENUM('AUSTRALIA_POST', 'TOLL', 'COURIERS_PLEASE', 'DHL', 'UPS')   ,
ADD COLUMN `trackingNumber` varchar(191)   ,
DROP COLUMN `paymentProvider`,
ADD COLUMN `paymentProvider` ENUM('PAYPAL', 'CREDIT_CARD', 'AFTERPAY', 'ZIPPAY', 'LATITUDE_PAY', 'BANK_TRANSFER', 'CASH') NOT NULL  ;

ALTER TABLE `shop`.`Order` ADD FOREIGN KEY (`addressId`) REFERENCES `shop`.`Address`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200602060720-add-bank-transfer-payment-provider..20200602062145-add-order-shipping-tracking-information
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
     provider = "mysql"
-    url = "***"
+    url      = env("DATABASE_URL")
 }
 generator client {
     provider = "prisma-client-js"
@@ -16,10 +16,10 @@
     slug        String @unique
     description String
     price       Float
-    categories Category[]  @relation(references: [id])
-    OrderItem  OrderItem[]
+    categories   Category[]  @relation(references: [id])
+    orderedItems OrderItem[]
     createdAt DateTime @default(now())
     updatedAt DateTime @default(now())
 }
@@ -63,8 +63,9 @@
     customerId Int
     createdAt DateTime @default(now())
     updatedAt DateTime @default(now())
+    Order     Order[]
 }
 enum State {
     VIC
@@ -90,10 +91,17 @@
     customer   Customer @relation(fields: [customerId], references: [id])
     customerId Int
-    createdAt DateTime @default(now())
-    updatedAt DateTime @default(now())
+    address   Address @relation(fields: [addressId], references: [id])
+    addressId Int
+
+    shippingProvider ShippingProvider?
+    trackingNumber   String?
+
+    createdAt DateTime  @default(now())
+    updatedAt DateTime  @default(now())
+    shippedAt DateTime?
 }
 enum OrderStatus {
     PAYMENT_PENDING
@@ -118,8 +126,16 @@
     BANK_TRANSFER
     CASH
 }
+enum ShippingProvider {
+    AUSTRALIA_POST
+    TOLL
+    COURIERS_PLEASE
+    DHL
+    UPS
+}
+
 model OrderItem {
     id       Int   @id @default(autoincrement())
     price    Float
     quantity Int
```


